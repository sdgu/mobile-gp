"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var router_1 = require("@angular/router");
var router_2 = require("nativescript-angular/router");
var gpserv_service_1 = require("../gpserv/gpserv.service");
var page_1 = require("ui/page");
var clipboard = require("nativescript-clipboard");
var Toast = require("nativescript-toasts");
var BbComponent = (function () {
    function BbComponent(route, router, routerExtensions, page) {
        var _this = this;
        this.route = route;
        this.router = router;
        this.routerExtensions = routerExtensions;
        this.page = page;
        this.dispArr = [];
        this.tapped = [];
        this.bbStr = "";
        this.route.queryParams.subscribe(function (params) {
            _this.dispArr = params["dispArr"];
            _this.tapped = params["tapArr"];
            var bbArr = _this.dispArr;
            var adds = [];
            var rems = [];
            var coms = [];
            var start = 0;
            var end = -1;
            var prev = _this.tapped[0];
            if (prev === "add") {
                adds.push(start);
            }
            // still an issue here 1/1/2018 12:26 am
            for (var i = 1; i < _this.dispArr.length; i++) {
                if (prev !== "add" && _this.tapped[i] === "add") {
                    start = i;
                    adds.push(start);
                }
                if (_this.tapped[i] !== "add" && prev === "add") {
                    end = i - 1;
                    adds.push(end);
                }
                prev = _this.tapped[i];
            }
            console.log(adds);
            prev = _this.tapped[0];
            start = 0;
            if (prev === "remove") {
                rems.push(start);
            }
            for (var i = 1; i < _this.dispArr.length; i++) {
                if (prev !== "remove" && _this.tapped[i] === "remove") {
                    start = i;
                    rems.push(start);
                }
                if (_this.tapped[i] !== "remove" && prev === "remove") {
                    end = i - 1;
                    rems.push(end);
                }
                prev = _this.tapped[i];
            }
            console.log(rems);
            prev = _this.tapped[0];
            start = 0;
            if (prev === "comment") {
                coms.push(start);
            }
            for (var i = 1; i < _this.dispArr.length; i++) {
                if (prev !== "comment" && _this.tapped[i] === "comment") {
                    start = i;
                    coms.push(start);
                }
                if (_this.tapped[i] !== "comment" && prev === "comment") {
                    end = i - 1;
                    coms.push(end);
                }
                prev = _this.tapped[i];
            }
            console.log(coms);
            for (var i = 0; i < adds.length; i += 2) {
                bbArr[adds[i]] = "[b][color='blue']" + bbArr[adds[i]];
                bbArr[adds[i + 1]] = bbArr[adds[i + 1]] + "[/color][/b]";
            }
            for (var i = 0; i < rems.length; i += 2) {
                bbArr[rems[i]] = "[b][color='red'][s]" + bbArr[rems[i]];
                bbArr[rems[i + 1]] = bbArr[rems[i + 1]] + "[/s][/color][/b]";
            }
            for (var i = 0; i < coms.length; i += 2) {
                bbArr[coms[i]] = "[b][color='green']" + bbArr[coms[i]].replace("[c]", "");
                bbArr[coms[i + 1]] = bbArr[coms[i + 1]].replace("[/c]", "") + "[/color][/b]";
            }
            // for (let i = 0; i < this.dispArr.length; i++)
            // {
            // }
            _this.bbStr = bbArr.join(" ").replace(/ ========> /g, "\n");
        });
    }
    BbComponent.prototype.arrToBB = function (d, t) {
    };
    BbComponent.prototype.goBack = function () {
        this.routerExtensions.back();
    };
    BbComponent.prototype.copyToClipboard = function () {
        clipboard.setText(this.bbStr).then(function () {
            console.log("OK, copied to the clipboard");
        });
        var toastOptions = { text: "copied!", duration: Toast.DURATION.SHORT };
        Toast.show(toastOptions);
    };
    BbComponent = __decorate([
        core_1.Component({
            selector: "bb",
            // template: `
            //   <ActionBar title="My App" class="action-bar"></ActionBar>
            //   <!-- Your UI components go here -->
            // `
            templateUrl: "./bb/bb.component.html",
            styleUrls: ["./bb/bb.component.css", "./app.component.css"],
            providers: [gpserv_service_1.GpservService]
        }),
        __metadata("design:paramtypes", [router_1.ActivatedRoute, router_1.Router, router_2.RouterExtensions, page_1.Page])
    ], BbComponent);
    return BbComponent;
}());
exports.BbComponent = BbComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYmIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQWtEO0FBQ2xELDBDQUEyRTtBQUMzRSxzREFBOEQ7QUFDOUQsMkRBQXlEO0FBRXpELGdDQUErQjtBQVkvQixJQUFJLFNBQVMsR0FBRyxPQUFPLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQUVsRCwyQ0FBNkM7QUFZN0M7SUFjRSxxQkFBMkIsS0FBcUIsRUFBVSxNQUFjLEVBQVUsZ0JBQWtDLEVBQVUsSUFBVTtRQUF4SSxpQkF5R0U7UUF6R3lCLFVBQUssR0FBTCxLQUFLLENBQWdCO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUFVLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFBVSxTQUFJLEdBQUosSUFBSSxDQUFNO1FBWnhJLFlBQU8sR0FBa0IsRUFBRSxDQUFDO1FBQzVCLFdBQU0sR0FBa0IsRUFBRSxDQUFDO1FBRTNCLFVBQUssR0FBVyxFQUFFLENBQUM7UUFXakIsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUM5QixVQUFBLE1BQU07WUFFSixLQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNqQyxLQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUMvQixJQUFJLEtBQUssR0FBRyxLQUFJLENBQUMsT0FBTyxDQUFDO1lBQ3pCLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztZQUNkLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztZQUNkLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztZQUNkLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztZQUNkLElBQUksR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2IsSUFBSSxJQUFJLEdBQUcsS0FBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FB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Q2pDLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLENBQUMsQ0FBQztRQUM3QyxDQUFDLENBQUMsQ0FBQTtRQUNGLElBQUksWUFBWSxHQUFzQixFQUFDLElBQUksRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFDLENBQUM7UUFDeEYsS0FBSyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBdElVLFdBQVc7UUFWdkIsZ0JBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxJQUFJO1lBQ2QsY0FBYztZQUNkLDhEQUE4RDtZQUM5RCx3Q0FBd0M7WUFDeEMsSUFBSTtZQUNKLFdBQVcsRUFBRSx3QkFBd0I7WUFDckMsU0FBUyxFQUFFLENBQUMsdUJBQXVCLEVBQUUscUJBQXFCLENBQUM7WUFDM0QsU0FBUyxFQUFFLENBQUMsOEJBQWEsQ0FBQztTQUMzQixDQUFDO3lDQWVrQyx1QkFBYyxFQUFrQixlQUFNLEVBQTRCLHlCQUFnQixFQUFnQixXQUFJO09BZDdILFdBQVcsQ0F5SXZCO0lBQUQsa0JBQUM7Q0FBQSxBQXpJRCxJQXlJQztBQXpJWSxrQ0FBVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgUm91dGVyLCBOYXZpZ2F0aW9uRXh0cmFzLCBBY3RpdmF0ZWRSb3V0ZSB9IGZyb20gXCJAYW5ndWxhci9yb3V0ZXJcIjtcclxuaW1wb3J0IHsgUm91dGVyRXh0ZW5zaW9ucyB9IGZyb20gXCJuYXRpdmVzY3JpcHQtYW5ndWxhci9yb3V0ZXJcIlxyXG5pbXBvcnQgeyBHcHNlcnZTZXJ2aWNlIH0gZnJvbSBcIi4uL2dwc2Vydi9ncHNlcnYuc2VydmljZVwiO1xyXG5pbXBvcnQgeyBUZXh0RmllbGQgfSBmcm9tIFwidWkvdGV4dC1maWVsZFwiO1xyXG5pbXBvcnQgeyBQYWdlIH0gZnJvbSBcInVpL3BhZ2VcIjtcclxuaW1wb3J0IHtcclxuICAgIGdldEJvb2xlYW4sXHJcbiAgICBzZXRCb29sZWFuLFxyXG4gICAgZ2V0TnVtYmVyLFxyXG4gICAgc2V0TnVtYmVyLFxyXG4gICAgZ2V0U3RyaW5nLFxyXG4gICAgc2V0U3RyaW5nLFxyXG4gICAgaGFzS2V5LFxyXG4gICAgcmVtb3ZlLFxyXG4gICAgY2xlYXJcclxufSBmcm9tIFwiYXBwbGljYXRpb24tc2V0dGluZ3NcIjtcclxudmFyIGNsaXBib2FyZCA9IHJlcXVpcmUoXCJuYXRpdmVzY3JpcHQtY2xpcGJvYXJkXCIpO1xyXG5cclxuaW1wb3J0ICogYXMgVG9hc3QgZnJvbSAnbmF0aXZlc2NyaXB0LXRvYXN0cyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogXCJiYlwiLFxyXG4gIC8vIHRlbXBsYXRlOiBgXHJcbiAgLy8gICA8QWN0aW9uQmFyIHRpdGxlPVwiTXkgQXBwXCIgY2xhc3M9XCJhY3Rpb24tYmFyXCI+PC9BY3Rpb25CYXI+XHJcbiAgLy8gICA8IS0tIFlvdXIgVUkgY29tcG9uZW50cyBnbyBoZXJlIC0tPlxyXG4gIC8vIGBcclxuICB0ZW1wbGF0ZVVybDogXCIuL2JiL2JiLmNvbXBvbmVudC5odG1sXCIsXHJcbiAgc3R5bGVVcmxzOiBbXCIuL2JiL2JiLmNvbXBvbmVudC5jc3NcIiwgXCIuL2FwcC5jb21wb25lbnQuY3NzXCJdLFxyXG4gIHByb3ZpZGVyczogW0dwc2VydlNlcnZpY2VdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBCYkNvbXBvbmVudCBcclxue1xyXG4gIGRpc3BBcnI6IEFycmF5PHN0cmluZz4gPSBbXTtcclxuICB0YXBwZWQ6IEFycmF5PHN0cmluZz4gPSBbXTtcclxuXHJcbiAgYmJTdHI6IHN0cmluZyA9IFwiXCI7XHJcblxyXG5cclxuXHJcbiAgYXJyVG9CQihkOiBBcnJheTxzdHJpbmc+LCB0OiBBcnJheTxzdHJpbmc+KVxyXG4gIHtcclxuXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSByb3V0ZTogQWN0aXZhdGVkUm91dGUsIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsIHByaXZhdGUgcm91dGVyRXh0ZW5zaW9uczogUm91dGVyRXh0ZW5zaW9ucywgcHJpdmF0ZSBwYWdlOiBQYWdlKVxyXG4gIHtcclxuICAgIHRoaXMucm91dGUucXVlcnlQYXJhbXMuc3Vic2NyaWJlKFxyXG4gICAgICBwYXJhbXMgPT5cclxuICAgICAge1xyXG4gICAgICAgIHRoaXMuZGlzcEFyciA9IHBhcmFtc1tcImRpc3BBcnJcIl07XHJcbiAgICAgICAgdGhpcy50YXBwZWQgPSBwYXJhbXNbXCJ0YXBBcnJcIl07XHJcbiAgICAgICAgbGV0IGJiQXJyID0gdGhpcy5kaXNwQXJyO1xyXG4gICAgICAgIGxldCBhZGRzID0gW107XHJcbiAgICAgICAgbGV0IHJlbXMgPSBbXTtcclxuICAgICAgICBsZXQgY29tcyA9IFtdO1xyXG4gICAgICAgIGxldCBzdGFydCA9IDA7XHJcbiAgICAgICAgbGV0IGVuZCA9IC0xO1xyXG4gICAgICAgIGxldCBwcmV2ID0gdGhpcy50YXBwZWRbMF07XHJcblxyXG4gICAgICAgIGlmIChwcmV2ID09PSBcImFkZFwiKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGFkZHMucHVzaChzdGFydCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHN0aWxsIGFuIGlzc3VlIGhlcmUgMS8xLzIwMTggMTI6MjYgYW1cclxuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMuZGlzcEFyci5sZW5ndGg7IGkrKylcclxuICAgICAgICB7XHJcbiAgICAgICAgICBpZiAocHJldiAhPT0gXCJhZGRcIiAmJiB0aGlzLnRhcHBlZFtpXSA9PT0gXCJhZGRcIilcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgc3RhcnQgPSBpO1xyXG4gICAgICAgICAgICBhZGRzLnB1c2goc3RhcnQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKHRoaXMudGFwcGVkW2ldICE9PSBcImFkZFwiICYmIHByZXYgPT09IFwiYWRkXCIpXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIGVuZCA9IGkgLSAxO1xyXG4gICAgICAgICAgICBhZGRzLnB1c2goZW5kKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgXHJcbiAgICAgICAgICBwcmV2ID0gdGhpcy50YXBwZWRbaV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnNvbGUubG9nKGFkZHMpO1xyXG4gICAgICAgIHByZXYgPSB0aGlzLnRhcHBlZFswXTtcclxuICAgICAgICBzdGFydCA9IDA7XHJcbiAgICAgICAgaWYgKHByZXYgPT09IFwicmVtb3ZlXCIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgcmVtcy5wdXNoKHN0YXJ0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0aGlzLmRpc3BBcnIubGVuZ3RoOyBpKyspXHJcbiAgICAgICAge1xyXG5cclxuICAgICAgICAgIGlmIChwcmV2ICE9PSBcInJlbW92ZVwiICYmIHRoaXMudGFwcGVkW2ldID09PSBcInJlbW92ZVwiKVxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBzdGFydCA9IGk7XHJcbiAgICAgICAgICAgIHJlbXMucHVzaChzdGFydCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAodGhpcy50YXBwZWRbaV0gIT09IFwicmVtb3ZlXCIgJiYgcHJldiA9PT0gXCJyZW1vdmVcIilcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgZW5kID0gaSAtIDE7XHJcbiAgICAgICAgICAgIHJlbXMucHVzaChlbmQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICBcclxuICAgICAgICAgIHByZXYgPSB0aGlzLnRhcHBlZFtpXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc29sZS5sb2cocmVtcyk7XHJcbiAgICAgICAgcHJldiA9IHRoaXMudGFwcGVkWzBdO1xyXG4gICAgICAgIHN0YXJ0ID0gMDtcclxuICAgICAgICBpZiAocHJldiA9PT0gXCJjb21tZW50XCIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgY29tcy5wdXNoKHN0YXJ0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0aGlzLmRpc3BBcnIubGVuZ3RoOyBpKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWYgKHByZXYgIT09IFwiY29tbWVudFwiICYmIHRoaXMudGFwcGVkW2ldID09PSBcImNvbW1lbnRcIilcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgc3RhcnQgPSBpO1xyXG4gICAgICAgICAgICBjb21zLnB1c2goc3RhcnQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKHRoaXMudGFwcGVkW2ldICE9PSBcImNvbW1lbnRcIiAmJiBwcmV2ID09PSBcImNvbW1lbnRcIilcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgZW5kID0gaSAtIDE7XHJcbiAgICAgICAgICAgIGNvbXMucHVzaChlbmQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICBcclxuICAgICAgICAgIHByZXYgPSB0aGlzLnRhcHBlZFtpXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc29sZS5sb2coY29tcyk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWRkcy5sZW5ndGg7IGkrPTIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgYmJBcnJbYWRkc1tpXV0gPSBcIltiXVtjb2xvcj0nYmx1ZSddXCIgKyBiYkFyclthZGRzW2ldXTtcclxuICAgICAgICAgIGJiQXJyW2FkZHNbaSsxXV0gPSBiYkFyclthZGRzW2krMV1dICsgXCJbL2NvbG9yXVsvYl1cIlxyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlbXMubGVuZ3RoOyBpKz0yKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGJiQXJyW3JlbXNbaV1dID0gXCJbYl1bY29sb3I9J3JlZCddW3NdXCIgKyBiYkFycltyZW1zW2ldXTtcclxuICAgICAgICAgIGJiQXJyW3JlbXNbaSsxXV0gPSBiYkFycltyZW1zW2krMV1dICsgXCJbL3NdWy9jb2xvcl1bL2JdXCJcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb21zLmxlbmd0aDsgaSs9MilcclxuICAgICAgICB7XHJcbiAgICAgICAgICBiYkFycltjb21zW2ldXSA9IFwiW2JdW2NvbG9yPSdncmVlbiddXCIgKyBiYkFycltjb21zW2ldXS5yZXBsYWNlKFwiW2NdXCIsIFwiXCIpO1xyXG4gICAgICAgICAgYmJBcnJbY29tc1tpKzFdXSA9IGJiQXJyW2NvbXNbaSsxXV0ucmVwbGFjZShcIlsvY11cIiwgXCJcIikgKyBcIlsvY29sb3JdWy9iXVwiXHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5kaXNwQXJyLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgIC8vIHtcclxuICAgICAgICAgIFxyXG4gICAgICAgIC8vIH1cclxuICAgICAgICAgIFxyXG4gICAgICAgIHRoaXMuYmJTdHIgPSBiYkFyci5qb2luKFwiIFwiKS5yZXBsYWNlKC8gPT09PT09PT0+IC9nLCBcIlxcblwiKTtcclxuICAgICAgfVxyXG4gICAgICAgIFxyXG4gICl9XHJcbiAgXHJcblxyXG4gIGdvQmFjaygpXHJcbiAge1xyXG4gICAgdGhpcy5yb3V0ZXJFeHRlbnNpb25zLmJhY2soKTtcclxuICB9XHJcblxyXG4gIGNvcHlUb0NsaXBib2FyZCgpXHJcbiAge1xyXG4gICAgICBjbGlwYm9hcmQuc2V0VGV4dCh0aGlzLmJiU3RyKS50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiT0ssIGNvcGllZCB0byB0aGUgY2xpcGJvYXJkXCIpO1xyXG4gICAgICB9KVxyXG4gICAgICBsZXQgdG9hc3RPcHRpb25zOlRvYXN0LlRvYXN0T3B0aW9ucyA9IHt0ZXh0OiBcImNvcGllZCFcIiwgZHVyYXRpb246IFRvYXN0LkRVUkFUSU9OLlNIT1JUfTtcclxuICAgICAgVG9hc3Quc2hvdyh0b2FzdE9wdGlvbnMpO1xyXG4gIH1cclxuXHJcblxyXG59Il19